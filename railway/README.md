# üöÇ Railway Production Deployment

–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Fanfiq –Ω–∞ Railway.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
railway/
‚îú‚îÄ‚îÄ api/                    # API —Å–µ—Ä–≤–∏—Å (FastAPI)
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ frontend/              # Frontend —Å–µ—Ä–≤–∏—Å (Next.js)
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ workers/               # Workers —Å–µ—Ä–≤–∏—Å (Celery)
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ parsers-ficbook/       # Ficbook –ø–∞—Ä—Å–µ—Ä (Prefect)
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.prod.yml # Production Docker Compose
‚îú‚îÄ‚îÄ production-env-example  # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ test-deployment.sh     # –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ deploy.sh             # –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
cd railway
chmod +x test-deployment.sh
./test-deployment.sh all
```

### 2. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Railway

```bash
# –ò–∑ –ø–∞–ø–∫–∏ railway
chmod +x deploy.sh
./deploy.sh [project-name]
```

–ò–ª–∏ —Å–ª–µ–¥—É–π—Ç–µ [–ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏](../RAILWAY_DEPLOYMENT.md)

## –°–µ—Ä–≤–∏—Å—ã

### API Service
- **–ü–∞–ø–∫–∞:** `api/`
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** FastAPI + PostgreSQL + Redis
- **–ü–æ—Ä—Ç:** 8000
- **Health check:** `/health`

### Frontend Service
- **–ü–∞–ø–∫–∞:** `frontend/`
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Next.js + TypeScript
- **–ü–æ—Ä—Ç:** 3000
- **API URL:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `NEXT_PUBLIC_API_URL`

### Workers Service
- **–ü–∞–ø–∫–∞:** `workers/`
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Celery + Redis
- **–û—á–µ—Ä–µ–¥–∏:** `crawl`, `normalize`

### Parsers Service
- **–ü–∞–ø–∫–∞:** `parsers-ficbook/`
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Prefect + Python
- **Pool:** `ficbook-pool`

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `production-env-example` –≤ Railway dashboard –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `DATABASE_URL` - PostgreSQL connection string
- `REDIS_URL` - Redis connection string
- `PORT` - –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `SENTRY_DSN` - –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫
- `SECRET_KEY` - –î–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- `DEBUG` - –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (False –¥–ª—è production)

## –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ production –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –ò–∑ –ø–∞–ø–∫–∏ railway
docker compose -f docker-compose.prod.yml up -d
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# API
curl http://localhost:8000/health

# Frontend
curl http://localhost:3000
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Railway Dashboard
- –õ–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- Environment variables

### Health Checks
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ health checks:
- API: HTTP –∑–∞–ø—Ä–æ—Å –Ω–∞ `/health`
- Database: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Redis: PING –∫–æ–º–∞–Ω–¥–∞
- Workers: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—Ä–æ–∫–µ—Ä–∞

## Troubleshooting

### –û—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ Dockerfile
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Railway's variable references: `${{Service.VARIABLE}}`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –ø–ª–∞–≥–∏–Ω –¥–æ–±–∞–≤–ª–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` —Ñ–æ—Ä–º–∞—Ç
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `alembic upgrade head`

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- Multi-stage Docker builds –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–æ–≤
- Health checks –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- Environment-specific –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Production-ready –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (DEBUG=False, etc.)

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–∏—Å—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ connection pooling –¥–ª—è –ë–î

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Railway variables
- HTTPS –≤–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- Database credentials –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ –∫–æ–¥

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [RAILWAY_DEPLOYMENT.md](../RAILWAY_DEPLOYMENT.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ Railway dashboard
3. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**üéâ –£–¥–∞—á–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è!**
