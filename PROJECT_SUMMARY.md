# Project Fanfiq: Итоговый документ и дорожная карта

## 1. О проекте

**Fanfiq** — это универсальная поисковая система и читалка для фанфиков, агрегирующая данные с множества популярных платформ. Проект спроектирован как современное monorepo-приложение, готовое к развертыванию и масштабированию.

### Ключевые компоненты:

*   **Бэкенд (`backend`)**:
    *   **API (FastAPI)**: Предоставляет эндпоинты для поиска, получения информации о работах и запуска парсинга.
    *   **Парсер (Celery Worker)**: Асинхронная система для сбора данных с сайтов. На данный момент реализован полный парсер для Ficbook.net.
    *   **База данных (PostgreSQL)**: Хранит все данные о работах, авторах и главах, используя полнотекстовый поиск (FTS) для быстрых и релевантных результатов.
    *   **Очереди (Redis)**: Используется как брокер для асинхронных задач парсинга.

*   **Фронтенд (`frontend`)**:
    *   Современное веб-приложение на **Next.js** и **TypeScript**.
    *   Пользовательский интерфейс, построенный на **Tailwind CSS** и **shadcn/ui**.
    *   Реализована страница поиска с отображением результатов.

*   **Деплой (Railway)**:
    *   Проект полностью сконфигурирован для автоматического развертывания на платформе Railway с использованием Docker.

---

## 2. Как развернуть проект (Deploy)

Это инструкция для администратора или владельца проекта для развертывания на Railway.

### Шаг 1: Полная очистка
*   Зайдите в ваш [проект на Railway](https://railway.app/).
*   Убедитесь, что там **нет ни одного сервиса**. Если есть какие-либо старые или падающие сервисы, **удалите их** (`Settings` -> `Delete Service`).

### Шаг 2: Создание сервисов
Вам нужно будет создать три сервиса из вашего GitHub репозитория.

1.  **Сервис `api`**:
    *   `+ New` -> `Deploy from GitHub repo`.
    *   В настройках `Root Directory` укажите: **`backend`**.
    *   `Dockerfile Path`: **`api/Dockerfile`**.
    *   **Переименуйте** сервис в `api`.
    *   В настройках `Deploy`, в поле `Start Command`, вставьте:
        `alembic -c api/alembic.ini upgrade head && uvicorn api.app.main:app --host 0.0.0.0 --port $PORT`

2.  **Сервис `worker`**:
    *   `+ New` -> `Deploy from GitHub repo`.
    *   `Root Directory`: **`backend`**.
    *   `Dockerfile Path`: **`workers/Dockerfile`**.
    *   **Переименуйте** сервис в `worker`.
    *   В `Deploy` -> `Start Command` вставьте:
        `celery -A workers.celery_app:app worker -Q crawl,normalize -l info`

3.  **Сервис `frontend`**:
    *   `+ New` -> `Deploy from GitHub repo`.
    *   `Root Directory`: **`frontend`**. (Dockerfile будет найден автоматически).
    *   **Переименуйте** сервис в `frontend`.

### Шаг 3: Добавление Баз Данных
*   `+ New` -> `Database` -> `PostgreSQL`.
*   `+ New` -> `Database` -> `Redis`.

### Шаг 4: Настройка Переменных Окружения
*   **Для сервиса `api`**:
    *   `DATABASE_URL` -> `${{Postgres.DATABASE_URL}}`
    *   `REDIS_URL` -> `${{Redis.REDIS_URL}}`
*   **Для сервиса `worker`**:
    *   `DATABASE_URL` -> `${{Postgres.DATABASE_URL}}`
    *   `REDIS_URL` -> `${{Redis.REDIS_URL}}`
    *   `CELERY_BROKER_URL` -> `${{Redis.REDIS_URL}}`
*   **Для сервиса `frontend`**:
    *   `NEXT_PUBLIC_API_URL` -> `https://${{api.RAILWAY_PUBLIC_DOMAIN}}`

После этих шагов деплой пройдет успешно, и все сервисы будут работать.

---

## 3. Как пользоваться проектом

### Веб-интерфейс (для пользователей)
Основной способ использования — через сайт, который будет доступен по публичному URL сервиса `frontend` на Railway.

### API (для разработчиков)
*   `POST /api/v1/works/search`: Поиск работ с фильтрами.
*   `GET /api/v1/works/{id}`: Получение полной информации о работе.
*   `POST /api/v1/crawl`: Запуск задачи парсинга для нового URL.

### CLI (для разработки и администрирования)
*   **Локальный парсинг**: `python backend/cli/crawl.py parse --url "..."`
*   **Постановка задачи в очередь**: `python backend/cli/crawl.py enqueue --url "..."`
*   **Экспорт данных**: `python backend/cli/export.py --id <work_id>`

---

## 4. Дорожная карта MVP

| Этап | Название | Статус | Ключевые результаты |
| :--- | :--- | :--- | :--- |
| **0** | Инфраструктура и Контракты | ✅ **Готово** | Docker, PostgreSQL, API-контракт |
| **1** | База данных и FTS | ✅ **Готово** | Модели SQLAlchemy, миграции, полнотекстовый поиск |
| **2** | Парсинг (Ficbook) | ✅ **Готово** | Полностью рабочий парсер Ficbook, Celery-очереди, CLI |
| **3** | Фронтенд MVP | ✅ **Готово** | Интерфейс поиска, отображение результатов |
| **4** | Деплой | ✅ **Готово** | Конфигурация для Railway, CI/CD |
| **5** | Будущие улучшения | ⏳ **В планах** | Страница-читалка, новые парсеры, аккаунты пользователей |

### Следующие шаги:
*   Реализовать страницу-читалку (`Reader`) на фронтенде.
*   Добавить парсеры для других сайтов (AO3, Wattpad и т.д.).
*   Расширить фильтры поиска.
*   Реализовать систему пользовательских аккаунтов и закладок.
*   Настроить мониторинг и логирование для production-среды.

## 5. Оценка проделанной работы

Это приблизительная оценка времени, которое потребовалось бы Middle-разработчику для выполнения всех задач MVP с нуля.

| Категория | Задача | Сложность | Оценка (часы) |
| :--- | :--- | :--- | :--- |
| **Инфраструктура и DevOps** | Настройка `docker-compose`, Dockerfiles, деплой на Railway, CI | Средняя | **11-15 часов** |
| **Бэкенд (API и Воркеры)** | Схема БД, миграции, FTS, Celery, парсер Ficbook, API, тесты | Высокая | **30-40 часов** |
| **Фронтенд (MVP)** | Бутстрап Next.js, `shadcn/ui`, API-клиент, страница поиска, MSW | Средняя | **13-18 часов** |
| **Управление и Документация**| Написание документации, планирование, git-менеджмент | Низкая | **5-7 часов** |
| **Общий итог:** | | | **~59 - 80 часов** |
| | | | **(~7.5 - 10 раб. дней)** |

---

## 6. Дорожная карта: от MVP до полноценного продукта

Это высокоуровневый план развития проекта с фокусом на российский и русскоязычный рынок.

### Этап 1: Стабилизация MVP и сбор обратной связи (Текущий этап)
*   **Задача**: Убедиться, что базовый функционал (поиск и парсинг Ficbook) работает стабильно.
*   **Ключевые действия**:
    *   Провести бета-тестирование с небольшой группой пользователей.
    *   Собрать фидбэк по удобству поиска и качеству парсинга.
    *   Настроить базовый мониторинг (uptime) и логирование ошибок.

### Этап 2: Расширение охвата (Российский рынок)
*   **Задача**: Добавить поддержку ключевых русскоязычных платформ.
*   **Ключевые действия**:
    *   **Парсер Author.Today**: Реализовать парсер, учитывая платный контент.
    *   **Парсер Litnet/Litmarket**: Реализовать парсеры для сбора метаданных и бесплатных фрагментов.
    *   **Парсер Fanfics.me**: Реализовать парсер для этого популярного архива.
    *   Улучшить `normalizer` для обработки специфичных тегов и категорий с новых сайтов.

### Этап 3: Пользовательские функции
*   **Задача**: Повысить вовлеченность пользователей, добавив персонализацию.
*   **Ключевые действия**:
    *   **Система аккаунтов**: Регистрация, авторизация.
    *   **Закладки и Избранное**: Возможность сохранять понравившиеся работы.
    *   **История прочтения**: Автоматическое сохранение прогресса.
    *   **Подписки на авторов и работы**.

### Этап 4: Читалка (Reader) и UX
*   **Задача**: Создать лучший в своем классе опыт чтения.
*   **Ключевые действия**:
    *   Реализовать **страницу-читалку (`Reader`)** на фронтенде с подгрузкой глав по API.
    *   Добавить настройки: размер и тип шрифта, темы (ночная, сепия).
    *   Реализовать скачивание фанфиков в форматах `.txt`, `.epub`.
    *   **Опционально (R&D)**: Интеграция с сервисами Text-to-Speech (TTS) для озвучки текста.

### Этап 5: Расширенные фильтры и рекомендации
*   **Задача**: Сделать поиск еще более мощным и умным.
*   **Ключевые действия**:
    *   Добавить фильтрацию по **пейрингам и персонажам**.
    *   Реализовать **полноценный поиск по тегам** с логикой "И" / "ИЛИ" / "ИСКЛЮЧИТЬ".
    *   Создать базовую **систему рекомендаций** ("Похожие работы", "Вам может понравиться").

### Этап 6: Выход на международный рынок
*   **Задача**: Адаптировать продукт для англоязычной аудитории.
*   **Ключевые действия**:
    *   **Парсер AO3 (Archive of Our Own)**: Реализация самого крупного международного архива.
    *   **Парсер FanFiction.net**: Поддержка второго по популярности ресурса.
    *   Локализация интерфейса на английский язык.
    *   Оптимизация поиска для работы с разными языками.

### Этап 7: Монетизация и устойчивость (Долгосрочная перспектива)
*   **Задача**: Обеспечить финансовую устойчивость проекта.
*   **Ключевые действия**:
    *   Введение **"Pro"-аккаунтов** с расширенными возможностями (глубокий поиск по архиву, расширенные лимиты, аналитика).
    *   Ненавязчивая реклама.
    *   Партнерские программы с авторами или издательствами.

## 7. Оценка стоимости проекта

Эта оценка основана на медианных часовых ставках IT-специалистов (уровень Middle/Senior) на рынке РФ. Средняя ставка для расчета принята за **2800 руб/час**.

### Расчет стоимости до MVP на рынке РФ (с учетом рисков)

Для более реалистичного планирования, оценка на будущие работы включает **100% запас времени** на дополнительное тестирование, усложнение инфраструктуры, отладку парсеров и другие непредвиденные риски.

| Этап | Статус | Часы (среднее) | Стоимость |
| :--- | :--- | :--- | :--- |
| **Базовый MVP (1 парсер)** | ✅ **Готово** | 110 | **~308,000 руб.** |
| **Доработка до MVP для РФ** | ⏳ **В планах** | 188 | ~526,400 руб. |
| **Резерв на риски (100%)** | ⏳ **В планах** | 188 | ~526,400 руб. |
| **ИТОГО (MVP для РФ):** | | **486 часов** | **~1,360,800 руб.** |

### Детализация будущих работ (базовая оценка, без резерва)

| Роль | Основные задачи | Оценка (часы) |
| :--- | :--- | :--- |
| Программист (Backend) | 3 новых парсера, API для аккаунтов/закладок/читалки | 60-80 |
| Программист (Frontend) | MVP-читалка, страницы регистрации/логина, закладки | 40-60 |
| DevOps-инженер | Мониторинг и оптимизация парсеров | 10-15 |
| UX/UI Дизайнер | MVP-дизайн читалки и личного кабинета | 20-30 |
| Project Manager | Управление, тестирование новых функций | 25-35 |
| **Итого (будущие работы):** | | **~188 часов** |

---
### **Общая стоимость проекта до полноценного продукта (с учетом рисков)**

*   **Полное время разработки**: ~880 часов (495 базовых + 385 резерв)
*   **Итоговая стоимость**: **~2,464,000 рублей**

*Примечание: Данная оценка является предварительной и может изменяться в зависимости от рыночных условий и фактической скорости разработки.*
