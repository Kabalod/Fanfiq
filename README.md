# Fanfiq ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∑–∞–ø—É—Å–∫ (MVP)

## –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏
- `docker-compose.yml` ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: PostgreSQL, Redis, RabbitMQ; –ø—Ä–æ—Ñ–∏–ª–∏ `optional` –¥–ª—è MinIO, pgAdmin, Flower.
- `infra/db/init.sql` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL (`unaccent`, `pg_trgm`) –∏ –±–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞.
- `env/.env.example` ‚Äî –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –ø–æ—Ä—Ç–∞–º–∏, –æ–∫–∞–Ω—á–∏–≤–∞—é—â–∏–º–∏—Å—è –Ω–∞ ...90.
- `contracts/openapi.yaml` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç API (–ø–æ–∏—Å–∫) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±—ç–∫–µ–Ω–¥–∞.
- `DEVELOPMENT.md` ‚Äî –≥–∞–π–¥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–±–µ–∫/—Ñ—Ä–æ–Ω—Ç, –∫–æ–º–∞–Ω–¥—ã, –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏).

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   cp env/.env.example .env
   ```
2. –ü–æ–¥–Ω–∏–º–∏—Ç–µ –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   ```bash
   docker compose up -d postgres redis rabbitmq
   ```
3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
   ```bash
   docker compose --profile optional up -d pgadmin minio flower
   ```
4. –ü—Ä–æ–≤–µ—Ä–∫–∞:
   - PostgreSQL: localhost:${POSTGRES_PORT_HOST:-54390}
   - Redis: localhost:${REDIS_PORT_HOST:-63790}
   - RabbitMQ UI: http://localhost:${RABBITMQ_MGMT_PORT_HOST:-15690}
   - pgAdmin: http://localhost:${PGADMIN_PORT_HOST:-50590}
   - MinIO: http://localhost:${MINIO_CONSOLE_PORT_HOST:-59091}

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫—Ä–∞—Ç–∫–æ)
- –°–µ—Ä–≤–∏—Å—ã: `api` (FastAPI), –ø–∞—Ä—Å–µ—Ä—ã `parser-*` (–ø–æ —Å–∞–π—Ç–∞–º), `normalizer`, `scheduler`.
- –•—Ä–∞–Ω–∏–ª–∏—â–∞: PostgreSQL 16 (FTS: `pg_trgm`+`unaccent`), Redis 7 (–∫—ç—à), RabbitMQ 3 (–æ—á–µ—Ä–µ–¥–∏), MinIO (–æ–ø—Ü.).
- –ü–æ—Ç–æ–∫: `scheduler ‚Üí RabbitMQ ‚Üí parser-* ‚Üí normalizer ‚Üí PostgreSQL`; `frontend ‚Üí api ‚Üí PostgreSQL/Redis`.
- API: `POST /api/v1/works/search` ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¢–ó. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –≤ `contracts/openapi.yaml`.

## –ü–∞—Ä—Å–µ—Ä (CLI)
- –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (–±–µ–∑ –æ—á–µ—Ä–µ–¥–µ–π):
  ```bash
  python backend/cli/crawl.py parse --site ficbook --url "https://ficbook.net/readfic/..."
  ```
- –ß–µ—Ä–µ–∑ Celery (Redis):
  ```bash
  docker compose up -d redis
  # –≤–æ—Ä–∫–µ—Ä—ã
  export REDIS_URL=redis://localhost:63790/0
  celery -A backend.workers.celery_app:app worker -Q crawl,normalize -l info
  # –∑–∞–¥–∞—á–∞
  python backend/cli/crawl.py enqueue --site ficbook --url "https://ficbook.net/readfic/..." --wait 60
  # —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  python backend/cli/export.py --id <work_id>
  ```
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü: `FICBOOK_COOKIE="PHPSESSID=...; other=...;"`

## üéØ –ü–ª–∞–Ω MVP - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –≠—Ç–∞–ø 0 ‚Äî –ò–Ω—Ñ—Ä–∞ –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (–ì–û–¢–û–í–û)
- Docker Compose –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã API (OpenAPI)
- Zod —Å—Ö–µ–º—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### ‚úÖ –≠—Ç–∞–ø 1 ‚Äî –ë–î –∏ FTS (–ì–û–¢–û–í–û)
- Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ö–µ–º—ã
- FTS —Å GIN –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ unaccent
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–æ–¥–µ–ª–∏ SQLAlchemy

### ‚úÖ –≠—Ç–∞–ø 2 ‚Äî –û—á–µ—Ä–µ–¥–∏ –∏ –ø–∞–π–ø–ª–∞–π–Ω (–ì–û–¢–û–í–û)
- Celery + Redis –±—Ä–æ–∫–µ—Ä
- –ü–∞—Ä—Å–µ—Ä Ficbook (–ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (parse/enqueue/export)
- API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

### üöß –≠—Ç–∞–ø 3 ‚Äî –§—Ä–æ–Ω—Ç–µ–Ω–¥ MVP (–°–õ–ï–î–£–Æ–©–ò–ô)
- Next.js + TypeScript + Tailwind
- shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- Storybook –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- MSW –¥–ª—è –º–æ–∫–æ–≤
- –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:
  - `SearchBar` + `FilterPanel`
  - `ResultsList` + `WorkCard` 
  - `ReaderShell` + `ReaderSettings`
  - API –∫–ª–∏–µ–Ω—Ç —Å zod –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

### ‚è≥ –≠—Ç–∞–ø 4 ‚Äî –ö—ç—à –∏ UX
- Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚è≥ –≠—Ç–∞–ø 5 ‚Äî –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ CI
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Health checks
- –ü–æ–ª–Ω–∞—è CI/CD –ø–∞–π–ø–ª–∞–π–Ω

## üîß –ß—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Å–µ–π—á–∞—Å

### –ë—ç–∫–µ–Ω–¥ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤)
- **FastAPI API** —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- **PostgreSQL** —Å FTS –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏
- **Redis** –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ Celery –±—Ä–æ–∫–µ—Ä–∞
- **Celery –≤–æ—Ä–∫–µ—Ä—ã** –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- **Alembic –º–∏–≥—Ä–∞—Ü–∏–∏** —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π –ë–î

### –ü–∞—Ä—Å–µ—Ä Ficbook (MVP –≥–æ—Ç–æ–≤)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –≥–ª–∞–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ cookies
- –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic —Å—Ö–µ–º—ã
- CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /api/v1/crawl` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–Ω—Ñ–∏–∫–∞
- `GET /api/v1/works/{id}` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —Ä–∞–±–æ—Ç—ã
- `POST /api/v1/works/search` ‚Äî –ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ unit —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞
- –ü–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CLI —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## –ò—Å—Ç–æ—Ä–∏—è –∫—Ä—É–ø–Ω—ã—Ö —à–∞–≥–æ–≤
- –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (compose, init.sql, env) ‚Äî –≥–æ—Ç–æ–≤–æ.
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç API –∏ –∑–∞–≥–ª—É—à–∫–∞ `search` (FastAPI) ‚Äî –≥–æ—Ç–æ–≤–æ.
- Zod-—Å—Ö–µ–º—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ ‚Äî –≥–æ—Ç–æ–≤–æ.
- –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `DEVELOPMENT.md`.
- FTS: –¥–æ–±–∞–≤–ª–µ–Ω—ã GIN-–∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–∏—Å–∫–∞ ‚Äî –≥–æ—Ç–æ–≤–æ.
- –ü–æ–ª–Ω—ã–π –ø–∞—Ä—Å–µ—Ä Ficbook (CLI/API), –≤–æ—Ä–∫–µ—Ä—ã Celery –∏ —ç–∫—Å–ø–æ—Ä—Ç ‚Äî –≥–æ—Ç–æ–≤–æ.
- **MVP –±—ç–∫–µ–Ω–¥ –∑–∞–≤–µ—Ä—à–µ–Ω** ‚Äî –ø–∞—Ä—Å–µ—Ä, API, –ë–î, –æ—á–µ—Ä–µ–¥–∏, —Ç–µ—Å—Ç—ã.

## –ö–∞–∫ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –¢–æ–ª—å–∫–æ –¥–≤–∞ —Ñ–∞–π–ª–∞: —ç—Ç–æ—Ç README (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–∑–∞–ø—É—Å–∫–∞) –∏ `DEVELOPMENT.md` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).
- –ö–∞–∂–¥—ã–π –∫—Ä—É–ø–Ω—ã–π —à–∞–≥ (–∏–Ω—Ñ—Ä–∞/–∫–æ–Ω—Ç—Ä–∞–∫—Ç/–º–∏–≥—Ä–∞—Ü–∏–∏/–ø–∞—Ä—Å–µ—Ä/—Ñ–∏—á–∞ —Ñ—Ä–æ–Ω—Ç–∞) ‚Äî –∫—Ä–∞—Ç–∫–∞—è –∑–∞–ø–∏—Å—å –≤ ¬´–ò—Å—Ç–æ—Ä–∏—è –∫—Ä—É–ø–Ω—ã—Ö —à–∞–≥–æ–≤¬ª –∏ –¥–µ—Ç–∞–ª—å –≤ `DEVELOPMENT.md`.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ü–æ—Ä—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ ¬´...90¬ª –∏ –≤–∞–ª–∏–¥–Ω—ã (< 65535). –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—Ç API: 58090.
- –î–ª—è Windows/WSL —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker Desktop –∑–∞–ø—É—â–µ–Ω.
- **–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≠—Ç–∞–ø 3 ‚Äî –§—Ä–æ–Ω—Ç–µ–Ω–¥ MVP**
